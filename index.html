<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz de Pilates | Pilates √âlite</title>
  <style>
    :root {
      --oro-frances: #C9B037;
      --oro-claro: #E6D58B;
      --negro: #000;
      --negro-mate: #1A1A1A;
      --oro: #FFD700;
      --plata: #C0C0C0;
      --bronce: #CD7F32;
    }

    body {
      font-family: 'Playfair Display', serif;
      background-color: var(--negro);
      color: var(--oro-frances);
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    .container {
      max-width: 800px;
      margin: auto;
      padding: 30px;
      background-color: var(--negro);
      border-radius: 12px;
      border: 2px solid var(--oro-frances);
    }

    h1, h2 {
      color: var(--oro-frances);
      letter-spacing: 1px;
    }

    button {
      background-color: var(--oro-frances);
      color: var(--negro);
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s;
    }

    button:hover {
      background-color: var(--oro-claro);
      transform: translateY(-2px);
    }

    input {
      padding: 10px;
      font-size: 1rem;
      margin: 10px;
      border-radius: 5px;
      border: none;
      width: 80%;
      max-width: 400px;
    }

    #ranking-global {
      margin-top: 30px;
      display: none; /* Esta secci√≥n se mantiene oculta ya que el ranking es por email */
    }

    .ranking-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .ranking-table th, .ranking-table td {
      padding: 12px;
      border: 1px solid var(--oro-frances);
    }

    .ranking-table th {
      background-color: var(--negro-mate);
    }

    .ranking-table tr:nth-child(even) {
      background-color: rgba(201, 176, 55, 0.1);
    }

    /* Estilos para los 3 primeros puestos (aunque no se usen en este modelo) */
    .first-place {
      background-color: var(--oro) !important;
      color: var(--negro);
      font-weight: bold;
    }

    .second-place {
      background-color: var(--plata) !important;
      color: var(--negro);
      font-weight: bold;
    }

    .third-place {
      background-color: var(--bronce) !important;
      color: var(--negro);
      font-weight: bold;
    }

    .podium-icon {
      font-size: 1.5rem;
      margin-right: 10px;
    }

    #feedback {
      display: none;
      background-color: #e74c3c;
      color: white;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
    }

    .logo {
      max-width: 200px;
      margin-bottom: 20px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="feedback">¬°Respuesta incorrecta! Pierdes una vida ‚ù§Ô∏è</div>
  <div class="container">
    <!-- IMAGEN DEL LOGO CORREGIDA -->
    <img src="https://static.wixstatic.com/media/ed6298_a9feb3bc2f894f2fb14e07593db423e6~mv2.png/v1/fill/w_438,h_139,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/logo.png" alt="Pilates √âlite" class="logo" />

    <div id="start-screen">
      <h1>Quiz de Pilates</h1>
      <input type="text" id="name" placeholder="Nombre completo" required />
      <input type="email" id="email" placeholder="Correo electr√≥nico" required />
      <input type="tel" id="phone" placeholder="Tel√©fono" />
      <br />
      <button onclick="startGame()">Comenzar</button>
    </div>

    <div id="game-screen" class="hidden">
      <h2 id="question"></h2>
      <div id="options"></div>
      <p>Vidas: <span id="lives">3</span> ‚ù§Ô∏è</p>
      <p>Puntos: <span id="score">0</span></p>
    </div>

    <div id="end-screen" class="hidden">
      <h2>Juego terminado</h2>
      <p id="final-score"></p>
      <p id="email-confirmation-message" class="hidden"></p> <!-- Nuevo p√°rrafo para el mensaje al usuario -->
      <button onclick="restartGame()">Jugar de nuevo</button>
    </div>

    <div id="ranking-global" class="hidden">
      <h2>üèÜ Ranking Global üèÜ</h2>
      <div id="ranking-table-container"></div>
      <button onclick="restartGame()">Volver a jugar</button>
    </div>
  </div>

  <script>
    // Base de datos de preguntas ampliada (estructura corregida)
    const questions = {
      easy: [
        {
          question: "¬øCu√°l es el principio b√°sico del Pilates que se enfoca en la zona abdominal?",
          options: ["Powerhouse", "Flexibilidad", "Resistencia"],
          answer: 0
        },
        {
          question: "¬øQu√© significa 'centro' en Pilates?",
          options: ["La parte superior del cuerpo", "El √°rea entre las costillas y la pelvis (Powerhouse)", "Las piernas"],
          answer: 1
        },
        {
          question: "¬øCu√°l de estas opciones NO es un beneficio com√∫n del Pilates?",
          options: ["Mejora la postura", "Aumenta la masa muscular r√°pidamente", "Reduce el estr√©s"],
          answer: 1
        },
        {
          question: "¬øC√≥mo se llama la respiraci√≥n utilizada en Pilates, que expande las costillas lateralmente?",
          options: ["Respiraci√≥n abdominal", "Respiraci√≥n tor√°cica", "Respiraci√≥n diafragm√°tica"],
          answer: 1
        },
        {
          question: "¬øQui√©n cre√≥ el m√©todo Pilates?",
          options: ["Basi Pilates", "Joseph Pilates", "Romana Kryzanowska"],
          answer: 1
        },
        { // Esta pregunta ha sido movida correctamente dentro del array 'easy'
          question: "¬øD√≥nde encuentro las normas de Pilates √âlite?",
          options: ["Publicadas en el peri√≥dico", "En la app donde pone Normas del Centro ", "En el B.O.E"],
          answer: 1
        }
      ],
      medium: [
        {
          question: "¬øQu√© aparato fue inventado por Joseph Pilates para rehabilitaci√≥n?",
          options: ["Pelota suiza", "Reformer", "Banda el√°stica"],
          answer: 1
        },
        {
          question: "¬øCu√°l es el objetivo principal del ejercicio 'The Hundred'?",
          options: ["Fortalecer las piernas", "Calentar el Powerhouse y el sistema cardiovascular", "Mejorar la flexibilidad de la columna"],
          answer: 1
        },
        {
          question: "¬øQu√© significa 'Controlog√≠a', el nombre original del m√©todo Pilates?",
          options: ["El arte de controlar la mente", "El control del cuerpo a trav√©s de la mente", "La disciplina del control muscular"],
          answer: 1
        },
        {
          question: "¬øQu√© parte del cuerpo es fundamental para iniciar cualquier movimiento en Pilates?",
          options: ["Los brazos", "Las piernas", "El Powerhouse (centro)"],
          answer: 2
        },
        {
          question: "¬øCu√°l de estos ejercicios se enfoca en la articulaci√≥n de la columna vertebral?",
          options: ["Leg Pull Front", "Roll Up", "Swan Dive"],
          answer: 1
        }
      ],
      hard: [
        {
          question: "¬øCu√°l de estos NO es un ejercicio cl√°sico de Pilates?",
          options: ["The Hundred", "Downward Dog", "Roll Up"],
          answer: 1
        },
        {
          question: "¬øQu√© principio de Pilates se refiere a la capacidad de realizar movimientos fluidos y sin interrupciones?",
          options: ["Precisi√≥n", "Fluidez", "Concentraci√≥n"],
          answer: 1
        },
        {
          question: "¬øQu√© m√∫sculo es clave en la conexi√≥n del Powerhouse y se activa al exhalar en Pilates?",
          options: ["Recto abdominal", "Transverso abdominal", "Oblicuos"],
          answer: 1
        },
        {
          question: "¬øCu√°l es el prop√≥sito del 'Magic Circle' (anillo m√°gico) en Pilates?",
          options: ["Medir el progreso", "A√±adir resistencia a los ejercicios", "Decoraci√≥n del estudio"],
          answer: 1
        },
        {
          question: "¬øQu√© ejercicio de Pilates se realiza acostado boca abajo y fortalece la espalda?",
          options: ["Teaser", "Spine Stretch Forward", "Swan Dive"],
          answer: 2
        },
        {
          question: "¬øQu√© significa el concepto de 'Imprinting' en Pilates?",
          options: ["Dejar una marca en el suelo", "Aplanar la zona lumbar contra la colchoneta", "Recordar los movimientos"],
          answer: 1
        },
        {
          question: "¬øQu√© aparato de Pilates permite realizar movimientos suspendidos y asistidos por muelles?",
          options: ["Cadillac/Trapeze Table", "Chair", "Ladder Barrel"],
          answer: 0
        },
        {
          question: "¬øCu√°l de las siguientes afirmaciones sobre la 'colocaci√≥n p√©lvica neutra' es correcta en Pilates?",
          options: ["La pelvis est√° totalmente retrovertida", "La pelvis est√° en una posici√≥n donde las caderas y el pubis est√°n nivelados", "La pelvis est√° totalmente antevertida"],
          answer: 1
        },
        {
          question: "¬øQu√© ejercicio es conocido por trabajar la fuerza abdominal mientras se articulan las piernas en el aire?",
          options: ["Single Leg Stretch", "Bridge", "Saw"],
          answer: 0
        },
        {
          question: "¬øCu√°l es el prop√≥sito de la 'visualizaci√≥n' en Pilates?",
          options: ["Imaginar figuras geom√©tricas", "Ayudar a conectar la mente con el cuerpo y ejecutar movimientos precisos", "Planificar la siguiente sesi√≥n"],
          answer: 1
        },
        {
          question: "¬øQu√© m√∫sculo principal se trabaja en el ejercicio 'Side Kick Series'?",
          options: ["B√≠ceps", "Gl√∫teos y oblicuos", "Pectorales"],
          answer: 1
        },
        {
          question: "¬øQu√© beneficio espec√≠fico aporta el Pilates para personas con dolor lumbar cr√≥nico?",
          options: ["Curaci√≥n milagrosa", "Fortalecimiento del core y mejora de la estabilidad espinal", "Solo relajaci√≥n"],
          answer: 1
        },
        {
          question: "¬øQu√© es el 'Roll Over' en Pilates?",
          options: ["Un giro de columna", "Un ejercicio donde las piernas van por encima de la cabeza", "Una ca√≠da controlada"],
          answer: 1
        },
        {
          question: "¬øQu√© significan las siglas 'C-Curve' en Pilates?",
          options: ["Curva de la cadera", "Curva de la columna vertebral en forma de 'C'", "Curva de la pierna"],
          answer: 1
        },
        {
          question: "¬øCu√°l es la funci√≥n del 'Spine Corrector' o 'Barril Peque√±o'?",
          options: ["Almacenar objetos", "Ayudar a la flexi√≥n y extensi√≥n de la columna, y trabajar el equilibrio", "Ser un asiento"],
          answer: 1
        },
        {
          question: "¬øQu√© ejercicio de Pilates es una secuencia de cinco movimientos que trabajan el abdomen y las piernas?",
          options: ["The Five Core Movements", "The Pilates Mat Sequence", "The Abdominal Series"],
          answer: 2
        },
        {
          question: "¬øCu√°l es el prop√≥sito de la 'articulaci√≥n de la columna' en Pilates?",
          options: ["Doblar la espalda por completo", "Mover la columna v√©rtebra por v√©rtebra con control", "Mantener la columna recta y r√≠gida"],
          answer: 1
        },
        {
          question: "¬øQu√© aparato de Pilates permite trabajar en una posici√≥n vertical y es excelente para el equilibrio?",
          options: ["Reformer", "Wunda Chair", "Cadillac"],
          answer: 1
        },
        {
          question: "¬øQu√© diferencia al Pilates de otros ejercicios de fuerza t√≠picos?",
          options: ["Solo se usa el peso corporal", "Se enfoca en la calidad del movimiento, el control y la conexi√≥n mente-cuerpo", "Es solo para rehabilitaci√≥n"],
          answer: 1
        },
        {
          question: "¬øCu√°l es la √∫ltima etapa de un entrenamiento de Pilates, seg√∫n Joseph Pilates?",
          options: ["Calentamiento", "Enfriamiento y estiramiento", "Fuerza"],
          answer: 1
        }
      ]
    };

    // Variables del juego
    let currentLevel = "easy";
    let currentQuestion = 0;
    let score = 0;
    let lives = 3;
    let playerName = "";
    let playerEmail = "";
    let playerPhone = "";
    
    // ¬°IMPORTANTE! URL de tu aplicaci√≥n web de Google Apps Script (la he insertado aqu√≠)
    // Aseg√∫rate de que esta URL sea la de tu √∫ltima implementaci√≥n con acceso "Cualquier persona"
    const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyPgIbOR7qigZNvmZupf_L1ZSdWrYm00q4NDtZ4ZmpoLv9H5kC9kWtNaumbUPYgsXAUkw/exec';


    // Elementos del DOM
    const startScreen = document.getElementById("start-screen");
    const gameScreen = document.getElementById("game-screen");
    const endScreen = document.getElementById("end-screen");
    const rankingGlobal = document.getElementById("ranking-global"); // Se mantiene, pero la secci√≥n estar√° oculta
    const emailConfirmationMessage = document.getElementById("email-confirmation-message"); // Nuevo elemento

    function startGame() {
      playerName = document.getElementById("name").value.trim();
      playerEmail = document.getElementById("email").value.trim();
      playerPhone = document.getElementById("phone").value.trim();

      if (!playerName || !playerEmail) {
        alert("Por favor completa al menos nombre y email");
        return;
      }

      startScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      loadQuestion();
    }

    function loadQuestion() {
      const levelQuestions = questions[currentLevel];
      if (currentQuestion >= levelQuestions.length) {
        nextLevel();
        return;
      }

      const q = levelQuestions[currentQuestion];
      document.getElementById("question").textContent = q.question;
      
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      q.options.forEach((option, index) => {
        const button = document.createElement("button");
        button.textContent = option;
        button.onclick = () => checkAnswer(index);
        optionsDiv.appendChild(button);
      });

      document.getElementById("lives").textContent = lives;
      document.getElementById("score").textContent = score;
    }

    function checkAnswer(selectedIndex) {
      const correctIndex = questions[currentLevel][currentQuestion].answer;
      
      if (selectedIndex === correctIndex) {
        score += currentLevel === "easy" ? 10 : currentLevel === "medium" ? 20 : 30;
        currentQuestion++;
        loadQuestion();
      } else {
        lives--;
        showFeedback();
        
        if (lives <= 0) {
          endGame();
        } else {
          currentQuestion++;
          // Si quedan vidas, carga la siguiente pregunta despu√©s de un breve retraso para el feedback
          if (currentQuestion < questions[currentLevel].length) {
              setTimeout(loadQuestion, 1000);
          } else {
              // Si no quedan m√°s preguntas en el nivel actual, pasa al siguiente o termina
              setTimeout(nextLevel, 1000); 
          }
        }
      }

      document.getElementById("lives").textContent = lives;
      document.getElementById("score").textContent = score;
    }

    function showFeedback() {
      const feedback = document.getElementById("feedback");
      feedback.style.display = "block";
      setTimeout(() => {
        feedback.style.display = "none";
      }, 1000);
    }

    function nextLevel() {
      if (currentLevel === "easy") {
        currentLevel = "medium";
      } else if (currentLevel === "medium") {
        currentLevel = "hard";
      } else {
        endGame(); // No hay m√°s niveles
        return;
      }
      currentQuestion = 0; // Reinicia el contador de preguntas para el nuevo nivel
      loadQuestion();
    }

    function endGame() {
      gameScreen.classList.add("hidden");
      endScreen.classList.remove("hidden");
      document.getElementById("final-score").textContent = `Puntuaci√≥n final: ${score} puntos`;

      // Guardar resultados enviando un email
      saveResults();
    }

    async function saveResults() {
      const playerData = {
        name: playerName,
        email: playerEmail,
        phone: playerPhone, // Puede ser null o vac√≠o si no lo complet√≥
        score: score,
        date: new Date().toISOString() // Formato ISO para facilidad en el backend
      };

      emailConfirmationMessage.textContent = "Enviando tu puntuaci√≥n...";
      emailConfirmationMessage.classList.remove("hidden");

      try {
        const response = await fetch(APPS_SCRIPT_WEB_APP_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(playerData),
          mode: 'cors'
        });

        if (!response.ok) {
          const errorText = await response.text(); 
          throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }

        const data = await response.json();
        console.log('Respuesta del servidor:', data);

        if (data.success) {
          emailConfirmationMessage.textContent = `¬°Tu puntuaci√≥n de ${score} puntos ha sido enviada! Recibir√°s un email de confirmaci√≥n.`;
        } else {
          emailConfirmationMessage.textContent = `Error al enviar: ${data.message || 'Int√©ntalo de nuevo.'}`;
        }
      } catch (error) {
        console.error('Error al enviar la puntuaci√≥n:', error);
        emailConfirmationMessage.textContent = 'Hubo un error de conexi√≥n al enviar tu puntuaci√≥n. Int√©ntalo de nuevo m√°s tarde.';
      }
    }

    // La funci√≥n showGlobalRanking() ya no es necesaria con el enfoque de email
    // Si tienes un bot√≥n que la llama, puedes eliminarlo o reasignarlo.
    // En este HTML, el bot√≥n "Ver Ranking Global" est√° oculto porque su div padre est√° hidden.

    function restartGame() {
      currentLevel = "easy";
      currentQuestion = 0;
      score = 0;
      lives = 3;
      
      rankingGlobal.classList.add("hidden"); // Asegura que la secci√≥n de ranking global est√© oculta
      endScreen.classList.add("hidden");
      startScreen.classList.remove("hidden");
      
      // Limpiar campos de entrada
      document.getElementById("name").value = "";
      document.getElementById("email").value = "";
      document.getElementById("phone").value = "";
      emailConfirmationMessage.classList.add("hidden"); // Ocultar el mensaje de confirmaci√≥n al reiniciar
    }
  </script>
</body>
</html>
